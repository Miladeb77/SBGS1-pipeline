#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /home/SBGS1/cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /home/SBGS1/cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /home/SBGS1/cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq:/cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq:delegated \
  swglh/bcl2fastq2@sha256:cd3a2d021acd810f5bd546ed9f65177bde6ed936fe11d557dc1899ff6a182231 /cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /home/SBGS1/cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /home/SBGS1/cromwell-executions/main/ec41369d-d72e-44e1-9b71-dbbfc13cd5fd/call-bcl2fastq/execution/docker_cid`

# return exit code
exit $rc
